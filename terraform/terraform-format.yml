---
name: Terraform Formatter
description: Runs terraform validate and format
inputs:
  terraform_version:
    description: 'Terraform version'
    required: true
    default: 0.12.31
runs:
  using: "composite"
  env:
    TF_PLUGIN_CACHE_DIR: /tmp/.terraform/plugins
    TERRAFORM_VERSION: ${{ inputs.terraform_version }}
  steps:
    - name: Run test
      run: |
        mkdir -p $TF_PLUGIN_CACHE_DIR
        cat <<EOF > provider.ci.tf
          provider "aws" {}
          provider "kubernetes" {}
          provider "helm" {}
        EOF
          terraform fmt -write=true provider.ci.tf
          terraform init
          terraform validate
          terraform fmt -check -recursive -diff .
